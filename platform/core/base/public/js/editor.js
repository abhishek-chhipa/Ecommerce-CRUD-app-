(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const t=function(){function t(e,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.loader=e,this.url=n,this.t=i}var n,i;return n=t,(i=[{key:"upload",value:function(){var e=this;return this.loader.file.then((function(t){return new Promise((function(n,i){e._initRequest(),e._initListeners(n,i,t),e._sendRequest(t)}))}))}},{key:"abort",value:function(){this.xhr&&this.xhr.abort()}},{key:"_initRequest",value:function(){var e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}},{key:"_initListeners",value:function(e,t,n){var i=this.xhr,a=this.loader,o=(0,this.t)("Cannot upload file:")+" ".concat(n.name,".");i.addEventListener("error",(function(){return t(o)})),i.addEventListener("abort",(function(){return t()})),i.addEventListener("load",(function(){var n=i.response;if(!n||!n.uploaded)return t(n&&n.error&&n.error.message?n.error.message:o);e({default:n.url})})),i.upload&&i.upload.addEventListener("progress",(function(e){e.lengthComputable&&(a.uploadTotal=e.total,a.uploaded=e.loaded)}))}},{key:"_sendRequest",value:function(e){var t=new FormData;t.append("upload",e),t.append("_token",$('meta[name="csrf-token"]').attr("content")),this.xhr.send(t)}}])&&e(n.prototype,i),t}();function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var o,r;return o=e,(r=[{key:"initCkEditor",value:function(e,a){var o=this;ClassicEditor.create(document.querySelector("#"+e),function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({fontSize:{options:[9,11,13,"default",17,16,18,19,21,22,23,24]},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"}]},placeholder:" ",toolbar:{items:["heading","|","fontColor","fontSize","fontBackgroundColor","fontFamily","bold","italic","underline","link","strikethrough","bulletedList","numberedList","|","codeBlock","outdent","indent","|","htmlEmbed","imageInsert","blockQuote","insertTable","mediaEmbed","undo","redo","findAndReplace","removeFormat","sourceEditing"]},language:"en",image:{toolbar:["imageTextAlternative","imageStyle:inline","imageStyle:block","imageStyle:side"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableCellProperties","tableProperties"]}},a)).then((function(n){n.plugins.get("FileRepository").createUploadAdapter=function(e){return new t(e,RV_MEDIA_URL.media_upload_from_editor,n.t)},n.insertHtml=function(e){var t=n.data.processor.toView(e),i=n.data.toModel(t);n.model.insertContent(i)},window.editor=n,o.CKEDITOR[e]=n;var i,a=90*$("#"+e).prop("rows"),r="ckeditor-".concat(e,"-inline");$(n.ui.view.editable.element).addClass(r).after("\n                    <style>\n                        .ck-editor__editable_inline {\n                            min-height: ".concat(a-100,"px;\n                            max-height: ").concat(a+100,"px;\n                        }\n                    </style>\n                ")),n.model.document.on("change:data",(function(){clearTimeout(i),i=setTimeout((function(){n.updateSourceElement()}),150)})),n.commands._commands.get("mediaEmbed").execute=function(e){n.insertHtml('[media url="'.concat(e,'"][/media]'))}})).catch((function(e){console.error(e)}))}},{key:"uploadImageFromEditor",value:function(e,t){var n=new FormData;"function"==typeof e.blob?n.append("upload",e.blob(),e.filename()):n.append("upload",e),$.ajax({type:"POST",data:n,url:RV_MEDIA_URL.media_upload_from_editor,processData:!1,contentType:!1,cache:!1,success:function(e){e.uploaded&&t(e.url)}})}},{key:"initTinyMce",value:function(e){var t=this;tinymce.init({menubar:!0,selector:"#"+e,min_height:110*$("#"+e).prop("rows"),resize:"vertical",plugins:"code autolink advlist visualchars link image media table charmap hr pagebreak nonbreaking hanbiroclip anchor insertdatetime lists textcolor wordcount imagetools  contextmenu  visualblocks",extended_valid_elements:"input[id|name|value|type|class|style|required|placeholder|autocomplete|onclick]",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image table | alignleft aligncenter alignright alignjustify  | numlist bullist indent  |  visualblocks code",convert_urls:!1,image_caption:!0,image_advtab:!0,image_title:!0,placeholder:"",contextmenu:"link image inserttable | cell row column deletetable",images_upload_url:RV_MEDIA_URL.media_upload_from_editor,automatic_uploads:!0,block_unsupported_drop:!1,file_picker_types:"file image media",images_upload_handler:this.uploadImageFromEditor.bind(this),file_picker_callback:function(e){$('<input type="file" accept="image/*" />').click().on("change",(function(n){t.uploadImageFromEditor(n.target.files[0],e)}))}})}},{key:"initEditor",value:function(e,t,n){if(!e.length)return!1;var i=this;switch(n){case"ckeditor":$.each(e,(function(e,n){i.initCkEditor($(n).prop("id"),t)}));break;case"tinymce":$.each(e,(function(e,t){i.initTinyMce($(t).prop("id"))}))}}},{key:"init",value:function(){var e=this,t=$(".editor-ckeditor"),n=$(".editor-tinymce"),i=this;return t.length>0&&i.initEditor(t,{},"ckeditor"),n.length>0&&i.initEditor(n,{},"tinymce"),this.CKEDITOR={},$(document).on("click",".show-hide-editor-btn",(function(t){t.preventDefault();var n=$(t.currentTarget),a=$("#"+n.data("result"));a.hasClass("editor-ckeditor")?e.CKEDITOR[n.data("result")]&&void 0!==e.CKEDITOR[n.data("result")]?(e.CKEDITOR[n.data("result")].destroy(),e.CKEDITOR[n.data("result")]=null,$(".editor-action-item").not(".action-show-hide-editor").hide()):(i.initCkEditor(n.data("result"),{},"ckeditor"),$(".editor-action-item").not(".action-show-hide-editor").show()):a.hasClass("editor-tinymce")&&tinymce.execCommand("mceToggleEditor",!1,n.data("result"))})),this.manageShortCode(),this}},{key:"manageShortCode",value:function(){var e=this;$(".list-shortcode-items li a").on("click",(function(t){var n=this;t.preventDefault(),"1"==$(this).data("has-admin-config")?($(".short-code-admin-config").html(""),$(".short_code_modal").modal("show"),$(".half-circle-spinner").show(),$.ajax({type:"GET",url:$(this).prop("href"),success:function(e){if(e.error)return Botble.showError(e.message),!1;$(".short-code-data-form").trigger("reset"),$(".short_code_input_key").val($(n).data("key")),$(".half-circle-spinner").hide(),$(".short-code-admin-config").html(e.data),Botble.initResources(),Botble.initMediaIntegrate(),""!==$(n).data("description")&&null!=$(n).data("description")&&$(".short_code_modal .modal-title strong").text($(n).data("description"))},error:function(e){Botble.handleError(e)}})):$(".editor-ckeditor").length>0?e.CKEDITOR[$(".add_shortcode_btn_trigger").data("result")].insertHtml("["+$(this).data("key")+"][/"+$(this).data("key")+"]"):tinymce.get($(".add_shortcode_btn_trigger").data("result")).execCommand("mceInsertContent",!1,"["+$(this).data("key")+"][/"+$(this).data("key")+"]")})),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""})),e},$(".add_short_code_btn").on("click",(function(t){t.preventDefault();var n=$(".short_code_modal").find(".short-code-data-form"),i=n.serializeObject(),a="";$.each(i,(function(e,t){var i=n.find('*[name="'+e+'"]').data("shortcode-attribute");i&&"content"===i||!t||(e=e.replace("[]",""),Array.isArray(t)?t.map((function(t,n){a+=" "+e+"_"+(n+1)+'="'+t+'"'})):a+=" "+e+'="'+t+'"')}));var o="",r=n.find("*[data-shortcode-attribute=content]");null!=r&&null!=r.val()&&""!==r.val()&&(o=r.val());var l=$(this).closest(".short_code_modal").find(".short_code_input_key").val();$(".editor-ckeditor").length>0?e.CKEDITOR[$(".add_shortcode_btn_trigger").data("result")].insertHtml("<div>["+l+a+"]"+o+"[/"+l+"]</div>"):tinymce.get($(".add_shortcode_btn_trigger").data("result")).execCommand("mceInsertContent",!1,"<div>["+l+a+"]"+o+"[/"+l+"]</div>"),$(this).closest(".modal").modal("hide")}))}}])&&a(o.prototype,r),e}();$(document).ready((function(){window.EDITOR=(new o).init(),window.EditorManagement=window.EditorManagement||o}))})();
